{% extends "main/base.html" %}
{% block content %}
<div class="container mt-5">
    <h2>Sign Up</h2>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="form-group">
            <label for="username">Username:</label>
            <input type="text" name="username" id="username" class="form-control" required>
        </div>
        <div class="form-group">
            <label for="email">Email:</label>
            <input type="email" name="email" id="email" class="form-control" required>
        </div>
        <div class="form-group">
            <label for="password">Password:</label>
            <input type="password" name="password" id="password" class="form-control" required>
        </div>
        <div class="form-group">
            <label for="roll">Role:</label>
            <select name="roll" id="roll" class="form-control" required>
                <option value="" disabled selected>Select your role</option>
            </select>
        </div>
        <div class="form-group">
            <label for="about">About:</label>
            <textarea name="about" id="about" class="form-control" rows="4" placeholder="Tell us about yourself"></textarea>
        </div>
        <div class="form-group">
            <label for="photo">Profile Photo:</label>
            <input type="file" name="photo" id="photo" class="form-control-file">
        </div>

        <button type="submit" class="btn btn-primary">Sign Up</button>
    </form>
</div>
<script>
    // Fetch roles from the API and populate the dropdown
    document.addEventListener("DOMContentLoaded", function() {
        const roleDropdown = document.getElementById("roll");
        fetch("/api/roles/") 
            .then(response => response.json())
            .then(data => {
                data.forEach(role => {
                    const option = document.createElement("option");
                    option.value = role.id;  // Use the role ID
                    option.textContent = role.name;  // Use the role name
                    roleDropdown.appendChild(option);
                });
            })
            .catch(error => {
                console.error("Error fetching roles:", error);
                alert("Failed to load roles. Please try again later.");
            });
    });

    function assignRole(profileId, roleName) {
    fetch(`/api/profiles/${profileId}/assign-role/`, {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer YOUR_ACCESS_TOKEN" 
        },
        body: JSON.stringify({ role_name: roleName })
    })
        .then(response => response.json())
        .then(data => {
            if (data.message) {
                alert(data.message);
            } else if (data.error) {
                alert(data.error);
            }
        })
        .catch(error => {
            console.error("Error assigning role:", error);
            alert("Failed to assign role. Please try again.");
        });
}
</script>
{% endblock %}
